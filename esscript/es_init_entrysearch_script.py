import datetime
import time

#startdate should be more 1,exp:i want 0101,so i input 0102,the result would run out from 0101
start = "20241001"
end = "20251231"
ipAddress = "192.168.2.120:9200"
interval = 30

def createAlias(dateStartArray):
	indexAlias = ""

	i = 0;
	while(i < interval):
		everyDay = dateStartArray + datetime.timedelta(days = i)
		indexAlias = indexAlias + str("{\"add\": {\"index\": \"atreus_entrysearch-" + dateStartArray.strftime("%Y%m%d"))
		indexAlias = indexAlias + str("\", \"alias\": \"atreus_entrysearch-r-" + everyDay.strftime("%Y%m%d"))
		indexAlias = indexAlias + str("\"}}, {\"add\": {\"index\": \"atreus_entrysearch-" + dateStartArray.strftime("%Y%m%d"))
		indexAlias = indexAlias + str("\", \"alias\": \"atreus_entrysearch-w-"+ everyDay.strftime("%Y%m%d") + "\"}},")
		i = i + 1

	return indexAlias

timeStart = time.strptime(start,"%Y%m%d")
timeEnd = time.strptime(end,"%Y%m%d")
timeStartStamp = int(time.mktime(timeStart))
timeEndStamp = int(time.mktime(timeEnd))
dateStartArray = datetime.datetime.utcfromtimestamp(timeStartStamp)
dateEndArray = datetime.datetime.utcfromtimestamp(timeEndStamp)

tagStart = str("curl -XPOST http://" + ipAddress + "/_aliases -d '{\"actions\": [")
tagEnd = str("{\"add\": {\"index\": \"atreus_entrysearch-other\", \"alias\": \"atreus_entrysearch-r-other\"}}, {\"add\": {\"index\": \"atreus_entrysearch-other\", \"alias\": \"atreus_entrysearch-w-other\"}}]}'" + " -u elastic:changeme" + " -H Content-Type:application/json" )
tagContent = ""

f = open("elasticsearch-entrysearch.sh","w")
while(dateStartArray < dateEndArray):
	strPut = str("curl -XPUT http://" + ipAddress + "/atreus_entrysearch-"+dateStartArray.strftime("%Y%m%d")+" -d '{\"mappings\":{\"entrysearch\":{\"_all\":{\"enabled\":false},\"dynamic\":false,\"properties\":{\"entryId\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"token\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"productCode\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"workflowCode\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"workflowVersion\":{\"type\":\"integer\",\"ignore_malformed\":true},\"workflowType\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"appName\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"customParams\":{\"type\":\"nested\",\"properties\":{\"name\":{\"type\":\"keyword\",\"ignore_above\":256},\"strValue\":{\"type\":\"keyword\",\"ignore_above\":256},\"longValue\":{\"type\":\"long\"},\"doubleValue\":{\"type\":\"double\"}}},\"idNumber\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"accountMobile\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"accountName\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"accountCard\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"applyLoanAmount\":{\"type\":\"long\",\"ignore_malformed\":true},\"batchNum\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"addType\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"test\":{\"type\":\"integer\",\"ignore_malformed\":true},\"finalDealType\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"entryStatus\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"reviewResult\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"loanAmount\":{\"type\":\"long\",\"ignore_malformed\":true},\"mainToken\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"tag\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"wholeId\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"entryOccurTime\":{\"type\":\"date\",\"ignore_malformed\":true},\"callDate\":{\"type\":\"long\",\"ignore_malformed\":true},\"recordTime\":{\"type\":\"long\",\"ignore_malformed\":true},\"statDate\":{\"type\":\"date\",\"ignore_malformed\":true},\"deviceInfo\":{\"properties\":{\"deviceId\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}}}},\"cost\":{\"type\":\"integer\",\"ignore_malformed\":true},\"strParams\":{\"properties\":{\"value\":{\"type\":\"text\",\"analyzer\":\"add_blank_analyzer\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}}}},\"longParams\":{\"type\":\"nested\",\"properties\":{\"name\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"value\":{\"type\":\"long\",\"ignore_malformed\":true}}},\"doubleParams\":{\"type\":\"nested\",\"properties\":{\"name\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"value\":{\"type\":\"double\",\"ignore_malformed\":true}}},\"policySet\":{\"type\":\"nested\",\"properties\":{\"nodeId\":{\"type\":\"keyword\",\"norms\":false,\"ignore_above\":256},\"eventId\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"dataSource\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"finalDealType\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"hitRules\":{\"type\":\"nested\",\"properties\":{\"uuid\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"eventId\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"state\":{\"type\":\"keyword\",\"ignore_above\":256},\"riskScore\":{\"type\":\"short\",\"ignore_malformed\":true},\"dealTypeName\":{\"type\":\"keyword\",\"ignore_above\":256}}}}},\"policySetScore\":{\"type\":\"nested\",\"properties\":{\"eventId\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"score\":{\"type\":\"long\",\"ignore_malformed\":true}}},\"model\":{\"type\":\"nested\",\"properties\":{\"nodeId\":{\"type\":\"keyword\",\"ignore_above\":256},\"uuid\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"riskBehaviorScore\":{\"type\":\"integer\",\"ignore_malformed\":true}}},\"decisionTool\":{\"type\":\"nested\",\"properties\":{\"nodeId\":{\"type\":\"keyword\",\"ignore_above\":256},\"uuid\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"dealType\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"thirdService\":{\"type\":\"nested\",\"properties\":{\"nodeId\":{\"type\":\"keyword\",\"ignore_above\":256},\"service\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"success\":{\"type\":\"boolean\"}}},\"gateway\":{\"type\":\"nested\",\"properties\":{\"nodeId\":{\"type\":\"keyword\",\"norms\":false,\"ignore_above\":100},\"branchNodeId\":{\"type\":\"keyword\",\"norms\":false,\"ignore_above\":100}}}}}},\"settings\":{\"number_of_replicas\":1,\"number_of_shards\":3,\"analysis\":{\"analyzer\":{\"add_blank_analyzer\":{\"type\":\"custom\",\"tokenizer\":\"standard\",\"char_filter\":[\"add_blank_filter\"],\"filter\":[\"standard\",\"lowercase\"]}},\"char_filter\":{\"add_blank_filter\":{\"type\":\"pattern_replace\",\"pattern\":\"(\\\\S)\",\"replacement\":\"$1 \"}}}}}' -u elastic:changeme"  + " -H Content-Type:application/json")
	print >> f,strPut
	tagContent = tagContent + createAlias(dateStartArray)
	dateStartArray = dateStartArray + datetime.timedelta(days = interval)

print >> f,str("curl -XPUT http://" + ipAddress + "/atreus_entrysearch-other -d '{\"mappings\":{\"entrysearch\":{\"_all\":{\"enabled\":false},\"dynamic\":false,\"properties\":{\"entryId\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"token\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"productCode\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"workflowCode\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"workflowVersion\":{\"type\":\"integer\",\"ignore_malformed\":true},\"workflowType\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"appName\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"customParams\":{\"type\":\"nested\",\"properties\":{\"name\":{\"type\":\"keyword\",\"ignore_above\":256},\"strValue\":{\"type\":\"keyword\",\"ignore_above\":256},\"longValue\":{\"type\":\"long\"},\"doubleValue\":{\"type\":\"double\"}}},\"idNumber\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"accountMobile\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"accountName\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"accountCard\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"applyLoanAmount\":{\"type\":\"long\",\"ignore_malformed\":true},\"batchNum\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"addType\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"test\":{\"type\":\"integer\",\"ignore_malformed\":true},\"finalDealType\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"entryStatus\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"reviewResult\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"loanAmount\":{\"type\":\"long\",\"ignore_malformed\":true},\"mainToken\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"tag\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"wholeId\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"entryOccurTime\":{\"type\":\"date\",\"ignore_malformed\":true},\"callDate\":{\"type\":\"long\",\"ignore_malformed\":true},\"recordTime\":{\"type\":\"long\",\"ignore_malformed\":true},\"statDate\":{\"type\":\"date\",\"ignore_malformed\":true},\"deviceInfo\":{\"properties\":{\"deviceId\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}}}},\"cost\":{\"type\":\"integer\",\"ignore_malformed\":true},\"strParams\":{\"properties\":{\"value\":{\"type\":\"text\",\"analyzer\":\"add_blank_analyzer\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}}}},\"longParams\":{\"type\":\"nested\",\"properties\":{\"name\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"value\":{\"type\":\"long\",\"ignore_malformed\":true}}},\"doubleParams\":{\"type\":\"nested\",\"properties\":{\"name\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"value\":{\"type\":\"double\",\"ignore_malformed\":true}}},\"policySet\":{\"type\":\"nested\",\"properties\":{\"nodeId\":{\"type\":\"keyword\",\"norms\":false,\"ignore_above\":256},\"eventId\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"dataSource\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"finalDealType\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"hitRules\":{\"type\":\"nested\",\"properties\":{\"uuid\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"eventId\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"state\":{\"type\":\"keyword\",\"ignore_above\":256},\"riskScore\":{\"type\":\"short\",\"ignore_malformed\":true},\"dealTypeName\":{\"type\":\"keyword\",\"ignore_above\":256}}}}},\"policySetScore\":{\"type\":\"nested\",\"properties\":{\"eventId\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"score\":{\"type\":\"long\",\"ignore_malformed\":true}}},\"model\":{\"type\":\"nested\",\"properties\":{\"nodeId\":{\"type\":\"keyword\",\"ignore_above\":256},\"uuid\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"riskBehaviorScore\":{\"type\":\"integer\",\"ignore_malformed\":true}}},\"decisionTool\":{\"type\":\"nested\",\"properties\":{\"nodeId\":{\"type\":\"keyword\",\"ignore_above\":256},\"uuid\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"dealType\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"thirdService\":{\"type\":\"nested\",\"properties\":{\"nodeId\":{\"type\":\"keyword\",\"ignore_above\":256},\"service\":{\"type\":\"text\",\"norms\":false,\"fields\":{\"raw\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"success\":{\"type\":\"boolean\"}}},\"gateway\":{\"type\":\"nested\",\"properties\":{\"nodeId\":{\"type\":\"keyword\",\"norms\":false,\"ignore_above\":100},\"branchNodeId\":{\"type\":\"keyword\",\"norms\":false,\"ignore_above\":100}}}}}},\"settings\":{\"number_of_replicas\":1,\"number_of_shards\":3,\"analysis\":{\"analyzer\":{\"add_blank_analyzer\":{\"type\":\"custom\",\"tokenizer\":\"standard\",\"char_filter\":[\"add_blank_filter\"],\"filter\":[\"standard\",\"lowercase\"]}},\"char_filter\":{\"add_blank_filter\":{\"type\":\"pattern_replace\",\"pattern\":\"(\\\\S)\",\"replacement\":\"$1 \"}}}}}' -u elastic:changeme"  + " -H Content-Type:application/json")
print >> f,str(tagStart + tagContent + tagEnd)
